
// Copyright (c) CLMS. All rights reserved.
// Licensed under the AGPL-3.0 license. See LICENSE file in the project root for full license information.
// This source file was autogenerated by zAppDev(r).

using System;
using System.Runtime.Serialization;
using System.Collections.Generic;
using System.ComponentModel;
using System.Linq;
using System.Reflection;
using System.Collections;
using zAppDev.DotNet.Framework.Utilities;
using zAppDev.DotNet.Framework.Configuration;
using zAppDev.DotNet.Framework.Data.Domain;

using DSS2_SynchromodalityCapacityOptimisation.DAL;

namespace DSS2_SynchromodalityCapacityOptimisation.BO
{
	/// <summary>
	/// The Platform extensions
	/// </summary>
	public static class PlatformExtensions
	{
        public static System.Collections.Generic.List<DSS2_SynchromodalityCapacityOptimisation.BO.SLAStatistics> CalculateOrderForecastAccuracy(System.Collections.Generic.List<int?> supplierIds, System.Collections.Generic.List<int?> warehouseIds, System.Collections.Generic.List<int?> businessUnitIds, System.Collections.Generic.List<int?> categoryIds, System.Collections.Generic.List<int?> subCategoryIds, System.Collections.Generic.List<int?> baseUnitIds, System.Collections.Generic.List<string> SKUs, DateTime? fromDate, DateTime? toDate){using (new zAppDev.DotNet.Framework.Profiling.Profiler("Platform", zAppDev.DotNet.Framework.Profiling.AppDevSymbolType.ClassOperation, "CalculateOrderForecastAccuracy")) {
System.Collections.Generic.List<DSS2_SynchromodalityCapacityOptimisation.BO.SLAStatistics> stats = new System.Collections.Generic.List<DSS2_SynchromodalityCapacityOptimisation.BO.SLAStatistics>();
System.Collections.Generic.List<int?> emptyIDs = new System.Collections.Generic.List<int?>();
System.Collections.Generic.List<string> emptySKUs = new System.Collections.Generic.List<string>();
if ((warehouseIds == null)) {
warehouseIds = emptyIDs.ToList();}
if ((SKUs == null)) {
SKUs = emptySKUs.ToList();}
if ((businessUnitIds == null)) {
businessUnitIds = emptyIDs.ToList();}
if ((categoryIds == null)) {
categoryIds = emptyIDs.ToList();}
if ((subCategoryIds == null)) {
subCategoryIds = emptyIDs.ToList();}
if ((baseUnitIds == null)) {
baseUnitIds = emptyIDs.ToList();}
if ((supplierIds == null)) {
supplierIds = emptyIDs.ToList();}
var _var0 = (fromDate?.Month ?? 0);var _var1 = (toDate?.Month ?? 0);System.Collections.Generic.List<DSS2_SynchromodalityCapacityOptimisation.BO.Platform> filteredPlatforms = new DSS2_SynchromodalityCapacityOptimisation.DAL.Repository().Get<DSS2_SynchromodalityCapacityOptimisation.BO.Platform>((a) => (SKUs.Count() == 0 || SKUs.Contains(a.Item.SKU)) && (businessUnitIds.Count() == 0 || businessUnitIds.Contains((a.Item.BusinessUnit.Id).GetValueOrDefault(0))) && (categoryIds.Count() == 0 || categoryIds.Contains((a.Item.Category.Id).GetValueOrDefault(0))) && (subCategoryIds.Count() == 0 || subCategoryIds.Contains((a.Item.SubCategory.Id).GetValueOrDefault(0))) && (baseUnitIds.Count() == 0 || baseUnitIds.Contains((a.Item.BaseUnit.Id).GetValueOrDefault(0))) && (supplierIds.Count() == 0 || supplierIds.Contains((a.Item.Supplier.Id).GetValueOrDefault(0))) && (warehouseIds.Count() == 0 || warehouseIds.Contains((a.Warehouse.Id).GetValueOrDefault(0))) && (fromDate == null || int.Parse(a.Month) >= _var0) && (toDate == null || int.Parse(a.Month) <= _var1));
System.Collections.Generic.List<int?> uniqueMonths = filteredPlatforms?.Select((a) => int.Parse(a.Month)).Select(_n => _n as int?).ToList().Distinct().ToList().OrderBy((a) => a).ToList();
foreach (var i in uniqueMonths ?? Enumerable.Empty<int?>()) {
System.Collections.Generic.List<DSS2_SynchromodalityCapacityOptimisation.BO.Platform> thisMonthsPlatforms = filteredPlatforms?.Where((a) => int.Parse(a.Month) == i).ToList();
if ((thisMonthsPlatforms?.Count() == 0)) {
continue;}
DSS2_SynchromodalityCapacityOptimisation.BO.SLAStatistics stat = new DSS2_SynchromodalityCapacityOptimisation.BO.SLAStatistics();
stat.Percentage = (thisMonthsPlatforms?.Sum((a) => a.percentage) ?? 0) / (thisMonthsPlatforms?.Count() ?? 0);stat.Percentage = Math.Round((stat?.Percentage ?? 0), 2) / 100;stat.Month = System.Globalization.CultureInfo.CurrentCulture.DateTimeFormat.GetMonthName((i).GetValueOrDefault(0));stat.Threshold = 80;stats?.Add(stat);
}
return stats;
}
}


public static System.Collections.Generic.List<DSS2_SynchromodalityCapacityOptimisation.BO.Platform> CalculatePlatform(){using (new zAppDev.DotNet.Framework.Profiling.Profiler("Platform", zAppDev.DotNet.Framework.Profiling.AppDevSymbolType.ClassOperation, "CalculatePlatform")) {
System.Collections.Generic.List<DSS2_SynchromodalityCapacityOptimisation.BO.Platform> leadTimes = new System.Collections.Generic.List<DSS2_SynchromodalityCapacityOptimisation.BO.Platform>();
foreach (var item in new DSS2_SynchromodalityCapacityOptimisation.DAL.Repository().GetAsQueryable<DSS2_SynchromodalityCapacityOptimisation.BO.Item>()?.Take(15).ToList() ?? Enumerable.Empty<DSS2_SynchromodalityCapacityOptimisation.BO.Item>()) {
DSS2_SynchromodalityCapacityOptimisation.BO.Platform leadTime = new DSS2_SynchromodalityCapacityOptimisation.BO.Platform();
leadTime.RealOrderedQuantities = (decimal)((new Random((int)(((item?.AvgDailyDemand ?? 0) + (item?.AvgDailyDemand ?? 0) + (item?.AvgDailyDemand ?? 0))))).Next(100, 2000));leadTime.ForecastOrders = (decimal)((new Random(Math.Abs((int)(((item?.AvgDailyDemand ?? 0) + (item?.AvgDailyDemand ?? 0) - (item?.AvgDailyDemand ?? 0)))))).Next(100, 2000));leadTime.Item = item;leadTime.percentage = Math.Abs(((leadTime?.ForecastOrders ?? 0)) / (leadTime?.RealOrderedQuantities ?? 0)) * 100;leadTime.ItemDescription = (item?.Description?.Substring(0, 15) ?? "");if (((leadTime?.percentage ?? 0) > 0.5m)) {
decimal? perc = (new Random((int)(((item?.AvgDailyDemand ?? 0) + (item?.AvgDailyDemand ?? 0))))).Next(1, 3);
leadTime.percentage = ((perc.GetValueOrDefault(0) * (item?.AvgDailyDemand ?? 0)) / 100) + (leadTime?.percentage ?? 0) - 100;}
if (((leadTime?.percentage ?? 0) > 15)) {
leadTime.percentage = (leadTime?.percentage ?? 0) - 20;}
if (((leadTime?.percentage ?? 0) < 0)) {
leadTime.percentage = (leadTime?.percentage ?? 0) + 10;}
leadTimes?.Add(leadTime);
new DSS2_SynchromodalityCapacityOptimisation.DAL.Repository().Save<DSS2_SynchromodalityCapacityOptimisation.BO.Platform>(leadTime);
}
return leadTimes;
}
}



        
	}
}
